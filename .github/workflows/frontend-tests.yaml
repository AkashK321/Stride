# ============================================================================
# WORKFLOW: Frontend Tests
# ============================================================================
#
# PURPOSE:
#   Run frontend unit tests on push events to branches. This workflow runs
#   on pushes to provide fast feedback during development. PR validation
#   is handled by pr-validation.yaml.
#
# TRIGGERS:
#   1. Push events:
#      - Branches: all branches
#      - Paths: frontend/**, .github/workflows/**
#      - Runs: Frontend Unit Tests
#
# WORKFLOW FLOW:
#   Push Event (to any branch)
#       ↓
#   frontend-tests runs
#       ↓
#   [Install Dependencies] → [Run Unit Tests] → [Publish Test Results]
#       ↓
#   [Test results visible on commit]
#
# OUTPUTS:
#   - Test results (published to GitHub commit checks)
#   - Coverage reports (if configured)
#
# DEPENDENCIES:
#   - None (standalone frontend test workflow)
#
# ============================================================================

name: Frontend Tests

on:
  push:
    branches:
      - '**'
    paths:
      - 'frontend/**'
      - '.github/workflows/**'

# Permissions required for test-reporter
permissions:
  contents: read
  checks: write      # Required for test-reporter to create check runs
  pull-requests: write  # Required for PR comments (if test-reporter adds them)

# Prevent multiple concurrent runs on the same branch
concurrency:
  group: frontend-tests-${{ github.ref }}
  cancel-in-progress: true

jobs:
  frontend-unit-tests:
    name: Frontend Unit Tests
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      # Step 1: Checkout the repository code
      - name: Checkout code
        uses: actions/checkout@v4
      
      # Step 2: Set up Node.js 20 with npm cache
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      
      # Step 3: Install dependencies
      - name: Install dependencies
        working-directory: frontend
        run: npm ci --legacy-peer-deps
      
      # Step 4: Run unit tests
      - name: Run unit tests
        working-directory: frontend
        run: npm test -- --ci --coverage
      
      # Step 5: Publish test results to GitHub
      - name: Publish test results
        if: always()
        uses: dorny/test-reporter@v1
        with:
          name: Frontend Test Results
          path: frontend/coverage/junit.xml
          reporter: jest-junit
          fail-on-error: false
          list-suites: all
          list-tests: all
